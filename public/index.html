<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Multiplayer</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/vue-i18n@9/dist/vue-i18n.global.prod.js"></script>
    <script src="https://cdn.tailwindcss.com/3.4.1"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'parchment': {
                            50: '#fefdf8',
                            100: '#fdf9e7',
                            200: '#faf0c4',
                            300: '#f5e197',
                            400: '#edc968',
                            500: '#e4b143',
                            600: '#d49c35',
                            700: '#b17f2e',
                            800: '#8f652b',
                            900: '#755327',
                        },
                        'ink': {
                            600: '#4a5568',
                            700: '#2d3748',
                            800: '#1a202c',
                        }
                    },
                    fontFamily: {
                        'serif': ['Crimson Text', 'Libre Baskerville', 'serif'],
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap');

        .book-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .book-page {
            background: linear-gradient(135deg, #fefdf8 0%, #fdf9e7 100%);
            position: relative;
        }

        .book-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23f5e197' fill-opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            pointer-events: none;
        }

        .text-shadow { text-shadow: 0 0 4px rgba(0, 0, 0, 0.2); }
    </style>

    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#b45309">
</head>
<body>

<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js')
            .then(registration => {
                console.log('Service Worker registered with scope:', registration.scope);
            })
            .catch(error => {
                console.log('Service Worker registration failed:', error);
            });
        });
    }
</script>
</head>

<body class="book-page min-h-screen font-serif">
    <div id="app">
        <div class="container mx-auto px-4 py-8 max-w-4xl" :key="currentLocale">
            <!-- Language Selector -->
            <div class="absolute top-4 right-4">
                <select :value="currentLocale" @change="changeLanguage($event.target.value)"
                    class="text-xs bg-parchment-100 border border-parchment-300 rounded px-2 py-1 text-ink-700 font-sans focus:outline-none focus:ring-1 focus:ring-parchment-500">
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="pl">ğŸ‡µğŸ‡± Polski</option>
                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                    <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
                    <option value="szl">ğŸ´ ÅšlÅnski</option>
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="pt">ğŸ‡§ğŸ‡· PortuguÃªs</option>
                    <option value="ga">ğŸ‡®ğŸ‡ª Gaeilge</option>
                    <option value="hi">ğŸ‡®ğŸ‡³ à¤¹à¤¿à¤¨à¥à¤¦à¥€</option>
                </select>
            </div>
        </div>

        <header class="text-center mb-8 transition-all duration-300 ease-in-out" :class="{ 'scale-[0.75]': gameState !== 'menu' }">
            <h1 class="text-4xl font-bold text-ink-800 mb-2">ğŸ“š Quiz Multiplayer</h1>
            <p v-if="gameState === 'menu'" class="text-ink-600 text-lg transition-opacity duration-300">{{ $t('subtitle') }}</p>
        </header>

        <!-- Error Message -->
        <div v-if="error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 max-w-lg mx-auto">
            {{ error }}
        </div>

        <!-- Success Message -->
        <div v-if="message" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4 max-w-lg mx-auto">
            {{ message }}
        </div>

        <!-- Menu State -->
        <div v-if="gameState === 'menu'" class="max-w-md mx-auto">
            <div class="bg-parchment-100 p-8 rounded-lg book-shadow border border-parchment-300">
                <!-- Create New Game Section -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-ink-800 mb-6 text-center">{{ $t('createNewGame') }}</h2>

                    <div class="space-y-4 mb-6">
                        <div>
                            <label class="block text-ink-700 font-sans mb-2">{{ $t('yourName') }}:</label>
                            <input v-model="playerNameCreate" type="text"
                                class="w-full p-3 border border-parchment-400 rounded-lg bg-parchment-50 text-ink-800 font-sans focus:outline-none focus:ring-2 focus:ring-parchment-500"
                                :placeholder="$t('enterYourName')" maxlength="20" @keyup.enter="createGame">
                        </div>
                    </div>

                    <button @click="createGame"
                        class="w-full bg-parchment-500 hover:bg-parchment-600 text-white text-shadow font-sans font-bold py-3 px-6 rounded-lg book-shadow transition-colors">
                        ğŸ² {{ $t('createNewGameButton') }}
                    </button>
                </div>

                <!-- Divider -->
                <div class="relative my-8">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-parchment-400"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-4 bg-parchment-100 text-ink-600 font-sans">{{ $t('or') }}</span>
                    </div>
                </div>

                <!-- Join Game Section -->
                <div>
                    <h2 class="text-2xl font-bold text-ink-800 mb-6 text-center">{{ $t('joinGame') }}</h2>

                    <div class="space-y-4 mb-6">
                        <div>
                            <label class="block text-ink-700 font-sans mb-2">{{ $t('yourName') }}:</label>
                            <input v-model="playerNameJoin" type="text"
                                class="oponent-name w-full p-3 border border-parchment-400 rounded-lg bg-parchment-50 text-ink-800 font-sans focus:outline-none focus:ring-2 focus:ring-parchment-500"
                                :placeholder="$t('enterYourName')" maxlength="20">
                        </div>

                        <div>
                            <label class="block text-ink-700 font-sans mb-2">{{ $t('gameCode') }}:</label>
                            <input v-model="gameCode" type="number" step="1" min="1111" max="9999"
                                class="w-full p-3 border border-parchment-400 rounded-lg bg-parchment-50 text-ink-800 font-sans focus:outline-none focus:ring-2 focus:ring-parchment-500"
                                :placeholder="$t('enterGameCode')" @keyup.enter="joinGame">
                        </div>
                    </div>

                    <button @click="joinGame"
                        class="w-full bg-ink-600 hover:bg-ink-700 text-white font-sans font-bold py-3 px-6 rounded-lg book-shadow transition-colors">
                        ğŸšª {{ $t('joinGameButton') }}
                    </button>
                </div>
            </div>
        </div>

        <!-- Waiting State -->
        <div v-if="gameState === 'waiting'" class="max-w-md mx-auto text-center">
            <div class="bg-parchment-100 p-8 rounded-lg book-shadow border border-parchment-300">
                <h2 class="text-2xl font-bold text-ink-800 mb-4">{{ $t('waitingForPlayer') }}</h2>
                <p class="text-ink-600 mb-4">{{ $t('gameCodeLabel') }}: <span class="font-bold text-2xl">{{ room?.code
                        }}</span></p>
                <p class="text-ink-600">{{ $t('shareCode') }}</p>
                <div class="mt-6">
                    <button @click="resetGame"
                        class="bg-gray-500 hover:bg-gray-600 text-white font-sans font-bold py-2 px-4 rounded">
                        {{ $t('backToMenu') }}
                    </button>
                </div>
            </div>
        </div>

        <!-- Playing State -->
        <div v-if="gameState === 'playing'" class="space-y-6">
            <!-- Game Info -->
            <div class="bg-parchment-100 p-6 rounded-lg book-shadow border border-parchment-300">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-ink-800">{{ $t('gameInProgress') }}</h2>
                    <div class="text-ink-600 font-sans">
                        {{ $t('round') }} {{ room?.currentRound || 1 }}/{{ room?.maxRounds || 3 }}
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center">
                        <div class="font-bold text-ink-800">{{ room?.players[0]?.name }}</div>
                        <div class="text-2xl font-bold text-parchment-600">{{ room?.players[0]?.score || 0 }}</div>
                        <div class="text-sm text-ink-600">{{ $t('completedRounds') }}: {{
                            room?.roundsCompleted?.[room?.players[0]?.id] || 0 }}</div>
                    </div>
                    <div class="text-center">
                        <div class="font-bold text-ink-800">{{ room?.players[1]?.name }}</div>
                        <div class="text-2xl font-bold text-parchment-600">{{ room?.players[1]?.score || 0 }}</div>
                        <div class="text-sm text-ink-600">{{ $t('completedRounds') }}: {{
                            room?.roundsCompleted?.[room?.players[1]?.id] || 0 }}</div>
                    </div>
                </div>
            </div>

            <!-- Question Form (when it's player's turn to ask) -->
            <div v-if="canAskQuestion" class="bg-parchment-100 p-6 rounded-lg book-shadow border border-parchment-300">
                <h3 class="text-xl font-bold text-ink-800 mb-4">{{ $t('yourTurnAsk') }}</h3>

                <div class="space-y-4">
                    <div>
                        <label class="block text-ink-700 font-sans mb-2">{{ $t('questionText') }}:</label>
                        <textarea v-model="questionForm.text"
                            class="w-full p-3 border border-parchment-400 rounded-lg bg-parchment-50 text-ink-800 font-sans focus:outline-none focus:ring-2 focus:ring-parchment-500"
                            rows="3" :placeholder="$t('enterQuestion')"></textarea>
                    </div>

                    <div>
                        <label class="block text-ink-700 font-sans mb-2">{{ $t('answers') }}:</label>
                        <div class="space-y-2">
                            <div v-for="(answer, index) in questionForm.answers" :key="index"
                                class="flex items-center space-x-2">
                                <input type="radio" :name="'correct-answer'" :value="index"
                                    v-model="questionForm.correctAnswer" class="text-parchment-500">
                                <input v-model="questionForm.answers[index]" type="text"
                                    class="flex-1 p-2 border border-parchment-400 rounded bg-parchment-50 text-ink-800 font-sans focus:outline-none focus:ring-2 focus:ring-parchment-500"
                                    :placeholder="$t('answer') + ' ' + (index + 1)">
                            </div>
                        </div>
                        <p class="text-sm text-ink-600 mt-2">{{ $t('selectCorrectAnswer') }}</p>
                    </div>

                    <button @click="submitQuestion"
                        class="w-full bg-parchment-500 hover:bg-parchment-600 text-white font-sans font-bold py-3 px-6 rounded-lg book-shadow transition-colors">
                        {{ $t('askQuestion') }}
                    </button>
                </div>
            </div>

            <!-- Answer Form (when it's player's turn to answer) -->
            <div v-if="canAnswerQuestion"
                class="bg-parchment-100 p-6 rounded-lg book-shadow border border-parchment-300">
                <h3 class="text-xl font-bold text-ink-800 mb-4">{{ $t('playerAsks', { name: otherPlayer?.name }) }}:
                </h3>

                <div class="bg-parchment-50 p-4 rounded-lg mb-4">
                    <p class="text-ink-800 text-lg">{{ room?.currentQuestion?.text }}</p>
                </div>

                <div class="space-y-2 mb-4">
                    <div v-for="(answer, index) in room?.currentQuestion?.answers" :key="index">
                        <label
                            class="flex items-center space-x-3 p-3 border border-parchment-300 rounded-lg hover:bg-parchment-50 cursor-pointer">
                            <input type="radio" :value="index" v-model="selectedAnswer" class="text-parchment-500">
                            <span class="text-ink-800">{{ answer }}</span>
                        </label>
                    </div>
                </div>

                <button @click="submitAnswer"
                    class="w-full bg-ink-600 hover:bg-ink-700 text-white font-sans font-bold py-3 px-6 rounded-lg book-shadow transition-colors"
                    :disabled="selectedAnswer === -1">
                    {{ $t('answer') }}
                </button>
            </div>

            <!-- Waiting for other player -->
            <div v-if="!canAskQuestion && !canAnswerQuestion"
                class="bg-parchment-100 p-6 rounded-lg book-shadow border border-parchment-300 text-center">
                <h3 class="text-xl font-bold text-ink-800 mb-2">{{ $t('waiting') }}...</h3>
                <p class="text-ink-600 flex items-center justify-center">
                    <span
                        class="inline-block w-4 h-4 border-2 border-ink-600 border-t-transparent rounded-full animate-spin mr-2"></span>
                    <template v-if="room?.currentQuestion">
                        {{ $t('playerThinking', { name: otherPlayer?.name }) }}
                    </template>
                    <template v-else>
                        {{ $t('playerPreparing', { name: otherPlayer?.name }) }}
                    </template>
                </p>
            </div>
        </div>

        <!-- Finished State -->
        <div v-if="gameState === 'finished'" class="text-center">
            <div class="bg-parchment-100 p-8 rounded-lg book-shadow border border-parchment-300">
                <h2 class="text-3xl font-bold text-ink-800 mb-4">ğŸ‰ {{ $t('gameFinished') }}!</h2>
                <p class="text-xl text-ink-600 mb-6">
                    {{ $t('winner') }}: <span class="font-bold">{{ room?.winner ? room.players.find(p => p.id ===
                        room.winner)?.name : $t('tie') }}</span>
                </p>

                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="text-center">
                        <div class="font-bold text-ink-800">{{ room?.players[0]?.name }}</div>
                        <div class="text-3xl font-bold text-parchment-600">{{ room?.players[0]?.score || 0 }}</div>
                    </div>
                    <div class="text-center">
                        <div class="font-bold text-ink-800">{{ room?.players[1]?.name }}</div>
                        <div class="text-3xl font-bold text-parchment-600">{{ room?.players[1]?.score || 0 }}</div>
                    </div>
                </div>

                <button @click="resetGameAfterFinish"
                    class="bg-parchment-500 hover:bg-parchment-600 text-white font-sans font-bold py-3 px-6 rounded-lg book-shadow transition-colors">
                    {{ $t('newGame') }}
                </button>
            </div>
        </div>
    </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, onUnmounted, watch } = Vue;
        const { createI18n } = VueI18n;

        // Function to detect browser language
        function getBrowserLanguage() {
            // First check saved preferences
            const savedLanguage = localStorage.getItem('preferredLanguage');
            if (savedLanguage) {
                return savedLanguage;
            }

            // If no saved preferences, use browser language
            const lang = navigator.language || navigator.userLanguage;
            const langCode = lang.split('-')[0];
            const supportedLanguages = ['pl', 'en', 'es', 'de', 'szl', 'zh', 'ja', 'pt', 'ga', 'hi'];
            return supportedLanguages.includes(langCode) ? langCode : 'en';
        }

        // Translation configuration
        const messages = {
            pl: {
                subtitle: 'Gra dla dwÃ³ch graczy',
                createNewGame: 'StwÃ³rz nowÄ… grÄ™',
                yourName: 'Twoje imiÄ™',
                enterYourName: 'Wpisz swoje imiÄ™...',
                createNewGameButton: 'StwÃ³rz nowÄ… grÄ™',
                or: 'lub',
                joinGame: 'DoÅ‚Ä…cz do gry',
                gameCode: 'Kod gry',
                enterGameCode: 'Wpisz 4-cyfrowy kod...',
                joinGameButton: 'DoÅ‚Ä…cz do gry',
                waitingForPlayer: 'Oczekiwanie na drugiego gracza...',
                gameCodeLabel: 'Kod gry',
                shareCode: 'Podziel siÄ™ tym kodem z drugim graczem',
                backToMenu: 'PowrÃ³t do menu',
                gameInProgress: 'Gra w toku',
                round: 'Runda',
                completedRounds: 'UkoÅ„czone rundy',
                yourTurnAsk: 'Twoja kolej - zadaj pytanie!',
                questionText: 'TreÅ›Ä‡ pytania',
                enterQuestion: 'Wpisz swoje pytanie...',
                answers: 'Odpowiedzi',
                answer: 'OdpowiedÅº',
                selectCorrectAnswer: 'Zaznacz poprawnÄ… odpowiedÅº',
                askQuestion: 'Zadaj pytanie',
                playerAsks: '{name} pyta',
                waiting: 'Oczekiwanie',
                playerThinking: '{name} myÅ›li nad odpowiedziÄ…',
                playerPreparing: '{name} przygotowuje pytanie',
                gameFinished: 'Gra zakoÅ„czona!',
                winner: 'ZwyciÄ™zca',
                tie: 'Remis',
                newGame: 'Nowa gra',
                errorMinAnswers: 'Podaj co najmniej 2 odpowiedzi',
                errorEmptyName: 'Podaj swoje imiÄ™',
                errorEmptyCode: 'Podaj kod gry',
                errorEmptyQuestion: 'Podaj treÅ›Ä‡ pytania',
                errorInvalidCode: 'Podaj prawidÅ‚owy 4-cyfrowy kod gry',
                errorConnection: 'BÅ‚Ä…d poÅ‚Ä…czenia z serwerem',
                // Nowe kody komunikatÃ³w:
                gameCreated: 'Gra utworzona! Kod: {code}',
                playerJoined: '{name} doÅ‚Ä…czyÅ‚ do gry! Gra rozpoczÄ™ta!',
                answerCorrect: '{name} odpowiedziaÅ‚ poprawnie i zdobywa punkt!',
                answerIncorrect: '{name} odpowiedziaÅ‚ niepoprawnie. Poprawna odpowiedÅº to: {correct}',
                questionSubmitted: 'Pytanie zostaÅ‚o zadane',
                answerSubmitted: 'OdpowiedÅº zostaÅ‚a wysÅ‚ana',
                tieBreaker: 'Remis! Runda dogrywki {round}!',
                nextRound: 'Koniec rundy {prev}. Rozpoczyna siÄ™ runda {next}!',
                gameFinished3Points: '{name} osiÄ…ga 3 punkty i wygrywa grÄ™!',
                errorJoinRoom: 'Nie znaleziono gry o podanym kodzie lub gra jest peÅ‚na',
                errorSubmitAnswer: 'Nie moÅ¼esz teraz odpowiedzieÄ‡ na pytanie',
                errorSubmitQuestion: 'Nie moÅ¼esz teraz zadaÄ‡ pytania',
                reconnectSuccess: 'PomyÅ›lnie przywrÃ³cono poÅ‚Ä…czenie!',
                playerRejoined: '{name} wrÃ³ciÅ‚ do gry!',
                errorReconnect: 'Nie moÅ¼na przywrÃ³ciÄ‡ gry. Gracz nie zostaÅ‚ znaleziony.'
            },
            en: {
                subtitle: 'Game for two players',
                createNewGame: 'Create New Game',
                yourName: 'Your Name',
                enterYourName: 'Enter your name...',
                createNewGameButton: 'Create New Game',
                or: 'or',
                joinGame: 'Join Game',
                gameCode: 'Game Code',
                enterGameCode: 'Enter 4-digit code...',
                joinGameButton: 'Join Game',
                waitingForPlayer: 'Waiting for second player...',
                gameCodeLabel: 'Game Code',
                shareCode: 'Share this code with the second player',
                backToMenu: 'Back to Menu',
                gameInProgress: 'Game in Progress',
                round: 'Round',
                completedRounds: 'Completed Rounds',
                yourTurnAsk: 'Your turn - ask a question!',
                questionText: 'Question Text',
                enterQuestion: 'Enter your question...',
                answers: 'Answers',
                answer: 'Answer',
                selectCorrectAnswer: 'Select the correct answer',
                askQuestion: 'Ask Question',
                playerAsks: '{name} asks',
                waiting: 'Waiting',
                playerThinking: '{name} is thinking about the answer',
                playerPreparing: '{name} is preparing a question',
                gameFinished: 'Game Finished!',
                winner: 'Winner',
                tie: 'Tie',
                newGame: 'New Game',
                errorMinAnswers: 'Provide at least 2 answers',
                errorEmptyName: 'Enter your name',
                errorEmptyCode: 'Enter game code',
                errorEmptyQuestion: 'Enter question text',
                errorInvalidCode: 'Enter a valid 4-digit game code',
                errorConnection: 'Connection error with server',
                // New message codes:
                gameCreated: 'Game created! Code: {code}',
                playerJoined: '{name} joined the game! Game started!',
                answerCorrect: '{name} answered correctly and scores a point!',
                answerIncorrect: '{name} answered incorrectly. Correct answer: {correct}',
                gameFinishedWinner: 'Game finished! {name} wins with {score} points!',
                tieBreaker: 'Tie! Sudden death round {round}!',
                nextRound: 'End of round {prev}. Round {next} begins!',
                gameFinished3Points: '{name} reaches 3 points and wins the game!',
                errorJoinRoom: 'Game not found or already full',
                errorSubmitAnswer: 'You cannot answer the question now',
                errorSubmitQuestion: 'You cannot ask a question now',
                reconnectSuccess: 'Successfully reconnected!',
                playerRejoined: '{name} rejoined the game!',
                errorReconnect: 'Cannot restore game. Player not found.'
            },
            es: {
                subtitle: 'Juego para dos jugadores',
                createNewGame: 'Crear Nuevo Juego',
                yourName: 'Tu Nombre',
                enterYourName: 'Ingresa tu nombre...',
                createNewGameButton: 'Crear Nuevo Juego',
                or: 'o',
                joinGame: 'Unirse al Juego',
                gameCode: 'CÃ³digo del Juego',
                enterGameCode: 'Ingresa cÃ³digo de 4 dÃ­gitos...',
                joinGameButton: 'Unirse al Juego',
                waitingForPlayer: 'Esperando al segundo jugador...',
                gameCodeLabel: 'CÃ³digo del Juego',
                shareCode: 'Comparte este cÃ³digo con el segundo jugador',
                backToMenu: 'Volver al MenÃº',
                gameInProgress: 'Juego en Progreso',
                round: 'Ronda',
                completedRounds: 'Rondas Completadas',
                yourTurnAsk: 'Â¡Tu turno - haz una pregunta!',
                questionText: 'Texto de la Pregunta',
                enterQuestion: 'Ingresa tu pregunta...',
                answers: 'Respuestas',
                answer: 'Respuesta',
                selectCorrectAnswer: 'Selecciona la respuesta correcta',
                askQuestion: 'Hacer Pregunta',
                playerAsks: '{name} pregunta',
                waiting: 'Esperando',
                playerThinking: '{name} estÃ¡ pensando en la respuesta',
                playerPreparing: '{name} estÃ¡ preparando una pregunta',
                gameFinished: 'Â¡Juego Terminado!',
                winner: 'Ganador',
                tie: 'Empate',
                newGame: 'Nuevo Juego',
                errorMinAnswers: 'Proporciona al menos 2 respuestas',
                errorEmptyName: 'Ingresa tu nombre',
                errorEmptyCode: 'Ingresa el cÃ³digo del juego',
                errorEmptyQuestion: 'Ingresa el texto de la pregunta',
                errorInvalidCode: 'Ingresa un cÃ³digo de juego vÃ¡lido de 4 dÃ­gitos',
                errorConnection: 'Error de conexiÃ³n con el servidor',
                // Nuevos cÃ³digos de mensajes:
                gameCreated: 'Â¡Juego creado! CÃ³digo: {code}',
                playerJoined: 'Â¡{name} se uniÃ³ al juego! Â¡Juego iniciado!',
                answerCorrect: 'Â¡{name} respondiÃ³ correctamente y gana un punto!',
                answerIncorrect: '{name} respondiÃ³ incorrectamente. Respuesta correcta: {correct}',
                questionSubmitted: 'Pregunta enviada',
                answerSubmitted: 'Respuesta enviada',
                tieBreaker: 'Â¡Empate! Â¡Ronda de desempate {round}!',
                nextRound: 'Fin de la ronda {prev}. Â¡Comienza la ronda {next}!',
                gameFinished3Points: 'Â¡{name} alcanza 3 puntos y gana el juego!',
                errorJoinRoom: 'No se encontrÃ³ el juego o ya estÃ¡ lleno',
                errorSubmitAnswer: 'No puedes responder la pregunta ahora',
                errorSubmitQuestion: 'No puedes hacer una pregunta ahora',
                reconnectSuccess: 'Â¡ReconexiÃ³n exitosa!',
                playerRejoined: 'Â¡{name} volviÃ³ al juego!',
                errorReconnect: 'No se puede restaurar el juego. Jugador no encontrado.'
            },
            de: {
                subtitle: 'Spiel fÃ¼r zwei Spieler',
                createNewGame: 'Neues Spiel Erstellen',
                yourName: 'Dein Name',
                enterYourName: 'Gib deinen Namen ein...',
                createNewGameButton: 'Neues Spiel Erstellen',
                or: 'oder',
                joinGame: 'Spiel Beitreten',
                gameCode: 'Spielcode',
                enterGameCode: 'Gib 4-stelligen Code ein...',
                joinGameButton: 'Spiel Beitreten',
                waitingForPlayer: 'Warten auf zweiten Spieler...',
                gameCodeLabel: 'Spielcode',
                shareCode: 'Teile diesen Code mit dem zweiten Spieler',
                backToMenu: 'ZurÃ¼ck zum MenÃ¼',
                gameInProgress: 'Spiel lÃ¤uft',
                round: 'Runde',
                completedRounds: 'Abgeschlossene Runden',
                yourTurnAsk: 'Du bist dran - stelle eine Frage!',
                questionText: 'Fragetext',
                enterQuestion: 'Gib deine Frage ein...',
                answers: 'Antworten',
                answer: 'Antwort',
                selectCorrectAnswer: 'WÃ¤hle die richtige Antwort',
                askQuestion: 'Frage Stellen',
                playerAsks: '{name} fragt',
                waiting: 'Warten',
                playerThinking: '{name} denkt Ã¼ber die Antwort nach',
                playerPreparing: '{name} bereitet eine Frage vor',
                gameFinished: 'Spiel Beendet!',
                winner: 'Gewinner',
                tie: 'Unentschieden',
                newGame: 'Neues Spiel',
                errorMinAnswers: 'Gib mindestens 2 Antworten an',
                errorEmptyName: 'Gib deinen Namen ein',
                errorEmptyCode: 'Gib den Spielcode ein',
                errorEmptyQuestion: 'Gib den Fragetext ein',
                errorInvalidCode: 'Gib einen gÃ¼ltigen 4-stelligen Spielcode ein',
                errorConnection: 'Verbindungsfehler mit dem Server',
                // Neue Nachrichtencodes:
                gameCreated: 'Spiel erstellt! Code: {code}',
                playerJoined: '{name} ist dem Spiel beigetreten! Spiel gestartet!',
                answerCorrect: '{name} hat richtig geantwortet und erhÃ¤lt einen Punkt!',
                answerIncorrect: '{name} hat falsch geantwortet. Richtige Antwort: {correct}',
                questionSubmitted: 'Frage gestellt',
                answerSubmitted: 'Antwort gesendet',
                gameFinishedWinner: 'Spiel beendet! {name} gewinnt mit {score} Punkten!',
                tieBreaker: 'Unentschieden! Entscheidungsrunde {round}!',
                nextRound: 'Ende der Runde {prev}. Runde {next} beginnt!',
                gameFinished3Points: '{name} erreicht 3 Punkte und gewinnt das Spiel!',
                errorJoinRoom: 'Spiel nicht gefunden oder bereits voll',
                errorSubmitAnswer: 'Du kannst jetzt keine Antwort geben',
                errorSubmitQuestion: 'Du kannst jetzt keine Frage stellen',
                reconnectSuccess: 'Erfolgreich wieder verbunden!',
                playerRejoined: '{name} ist dem Spiel wieder beigetreten!',
                errorReconnect: 'Spiel kann nicht wiederhergestellt werden. Spieler nicht gefunden.'
            },
            szl: {
                subtitle: 'GÅra dlo dwuch grÅczy',
                createNewGame: 'StwÅrz nowÅ gÅra',
                yourName: 'Twoje miano',
                enterYourName: 'WkludÅº swoje miano...',
                createNewGameButton: 'StwÅrz nowÅ gÅra',
                or: 'albo',
                joinGame: 'Przisz do gÅry',
                gameCode: 'KÅd gÅry',
                enterGameCode: 'WkludÅº 4-cyfrÅwy kÅd...',
                joinGameButton: 'Przisz do gÅry',
                waitingForPlayer: 'Czekanie na drugigo grÅcza...',
                gameCodeLabel: 'KÅd gÅry',
                shareCode: 'Podziel sie tym kÅdym z drugim grÅczym',
                backToMenu: 'Nazod do menu',
                gameInProgress: 'GÅra w toku',
                round: 'Runda',
                completedRounds: 'UkoÅ„czÅne rundy',
                yourTurnAsk: 'Twoja kolej - zadÅj pytanie!',
                questionText: 'TreÅ›Ä‡ pytanio',
                enterQuestion: 'WkludÅº swoje pytanie...',
                answers: 'Odpowiedzi',
                answer: 'OdpowiedÅº',
                selectCorrectAnswer: 'Zaznacz richtiÅ odpowiedÅº',
                askQuestion: 'ZadÅj pytanie',
                playerAsks: '{name} pyto',
                waiting: 'Czekanie',
                playerThinking: '{name} myÅ›li nad odpowiedziÅm',
                playerPreparing: '{name} szykuje pytanie',
                gameFinished: 'GÅra zakÅÅ„czÅno!',
                winner: 'WygrÅny',
                tie: 'Remis',
                newGame: 'NowÅ gÅra',
                errorMinAnswers: 'PodÅj co nojmyÅ„ 2 odpowiedzi',
                errorEmptyName: 'PodÅj swoje miano',
                errorEmptyCode: 'PodÅj kÅd gÅry',
                errorEmptyQuestion: 'PodÅj treÅ›Ä‡ pytanio',
                errorInvalidCode: 'PodÅj richtiÅ 4-cyfrÅwy kÅd gÅry',
                errorConnection: 'Feler poÅ‚Ånczenia z serwerym',
                // Nowe kody komunikatÃ³w:
                gameCreated: 'GÅra stworzÅno! KÅd: {code}',
                playerJoined: '{name} przisz do gÅry! GÅra zaczynÅ sie!',
                answerCorrect: '{name} podoÅ‚ richtiÅ odpowiedÅº i dostowo punkt!',
                answerIncorrect: '{name} podoÅ‚ Åºle. RichtiÅ odpowiedÅº to: {correct}',
                questionSubmitted: 'Pytanio zadane',
                answerSubmitted: 'OdpowiedÅº wysÅ‚ano',
                gameFinishedWinner: 'GÅra zakÅÅ„czÅno! WygrÅwÅ {name} z wynikiym {score} punktÅw!',
                tieBreaker: 'Remis! Runda dogrywki {round}!',
                nextRound: 'KÅniec rundy {prev}. ZaczynÅ sie runda {next}!',
                gameFinished3Points: '{name} mo 3 punkty i wygrywo gÅra!',
                errorJoinRoom: 'Niy znÅleziono gÅry abo je juÅ¼ peÅ‚no',
                errorSubmitAnswer: 'Niy moÅ¼esz teroz odpowiedzieÄ‡ na pytanie',
                errorSubmitQuestion: 'Niy moÅ¼esz teroz zadÅÄ‡ pytanio',
                reconnectSuccess: 'PoÅ‚Ånczenie przwrÅcone!',
                playerRejoined: '{name} wrÅciÅ‚ do gÅry!',
                errorReconnect: 'Niy idzie przwrÅciÄ‡ gÅry. GrÅcz niy znÅleziony.'
            },
            zh: {
                subtitle: 'åŒäººæ¸¸æˆ',
                createNewGame: 'åˆ›å»ºæ–°æ¸¸æˆ',
                yourName: 'ä½ çš„åå­—',
                enterYourName: 'è¾“å…¥ä½ çš„åå­—...',
                createNewGameButton: 'åˆ›å»ºæ–°æ¸¸æˆ',
                or: 'æˆ–è€…',
                joinGame: 'åŠ å…¥æ¸¸æˆ',
                gameCode: 'æ¸¸æˆä»£ç ',
                enterGameCode: 'è¾“å…¥4ä½æ•°å­—ä»£ç ...',
                joinGameButton: 'åŠ å…¥æ¸¸æˆ',
                waitingForPlayer: 'ç­‰å¾…ç¬¬äºŒä½ç©å®¶...',
                gameCodeLabel: 'æ¸¸æˆä»£ç ',
                shareCode: 'ä¸ç¬¬äºŒä½ç©å®¶åˆ†äº«æ­¤ä»£ç ',
                backToMenu: 'è¿”å›èœå•',
                gameInProgress: 'æ¸¸æˆè¿›è¡Œä¸­',
                round: 'å›åˆ',
                completedRounds: 'å·²å®Œæˆå›åˆ',
                yourTurnAsk: 'è½®åˆ°ä½ äº† - æé—®ï¼',
                questionText: 'é—®é¢˜å†…å®¹',
                enterQuestion: 'è¾“å…¥ä½ çš„é—®é¢˜...',
                answers: 'ç­”æ¡ˆ',
                answer: 'ç­”æ¡ˆ',
                selectCorrectAnswer: 'é€‰æ‹©æ­£ç¡®ç­”æ¡ˆ',
                askQuestion: 'æé—®',
                playerAsks: '{name} æé—®',
                waiting: 'ç­‰å¾…ä¸­',
                playerThinking: '{name} æ­£åœ¨æ€è€ƒç­”æ¡ˆ',
                playerPreparing: '{name} æ­£åœ¨å‡†å¤‡é—®é¢˜',
                gameFinished: 'æ¸¸æˆç»“æŸï¼',
                winner: 'è·èƒœè€…',
                tie: 'å¹³å±€',
                newGame: 'æ–°æ¸¸æˆ',
                errorMinAnswers: 'è¯·æä¾›è‡³å°‘2ä¸ªç­”æ¡ˆ',
                errorEmptyName: 'è¯·è¾“å…¥ä½ çš„åå­—',
                errorEmptyCode: 'è¯·è¾“å…¥æ¸¸æˆä»£ç ',
                errorEmptyQuestion: 'è¯·è¾“å…¥é—®é¢˜å†…å®¹',
                errorInvalidCode: 'è¯·è¾“å…¥æœ‰æ•ˆçš„4ä½æ•°å­—æ¸¸æˆä»£ç ',
                errorConnection: 'æœåŠ¡å™¨è¿æ¥é”™è¯¯',
                gameCreated: 'æ¸¸æˆå·²åˆ›å»ºï¼ä»£ç ï¼š{code}',
                playerJoined: '{name} åŠ å…¥äº†æ¸¸æˆï¼æ¸¸æˆå¼€å§‹ï¼',
                answerCorrect: '{name} å›ç­”æ­£ç¡®å¹¶è·å¾—1åˆ†ï¼',
                answerIncorrect: '{name} å›ç­”é”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š{correct}',
                gameFinishedWinner: 'æ¸¸æˆç»“æŸï¼{name} ä»¥ {score} åˆ†è·èƒœï¼',
                tieBreaker: 'å¹³å±€ï¼ç¬¬ {round} è½®å†³èƒœå±€ï¼',
                nextRound: 'ç¬¬ {prev} è½®ç»“æŸã€‚ç¬¬ {next} è½®å¼€å§‹ï¼',
                gameFinished3Points: '{name} è·å¾—3åˆ†å¹¶èµ¢å¾—æ¸¸æˆï¼',
                errorJoinRoom: 'æ‰¾ä¸åˆ°æŒ‡å®šä»£ç çš„æ¸¸æˆæˆ–æ¸¸æˆå·²æ»¡',
                errorSubmitAnswer: 'ä½ ç°åœ¨ä¸èƒ½å›ç­”é—®é¢˜',
                errorSubmitQuestion: 'ä½ ç°åœ¨ä¸èƒ½æé—®',
                reconnectSuccess: 'æˆåŠŸé‡æ–°è¿æ¥ï¼',
                playerRejoined: '{name} å›åˆ°äº†æ¸¸æˆï¼',
                errorReconnect: 'æ— æ³•æ¢å¤æ¸¸æˆã€‚æœªæ‰¾åˆ°ç©å®¶ã€‚',
                questionSubmitted: 'é—®é¢˜å·²æäº¤',
                answerSubmitted: 'ç­”æ¡ˆå·²æäº¤'
            },
            ja: {
                subtitle: '2äººç”¨ã‚²ãƒ¼ãƒ ',
                createNewGame: 'æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’ä½œæˆ',
                yourName: 'ã‚ãªãŸã®åå‰',
                enterYourName: 'åå‰ã‚’å…¥åŠ›...',
                createNewGameButton: 'æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’ä½œæˆ',
                or: 'ã¾ãŸã¯',
                joinGame: 'ã‚²ãƒ¼ãƒ ã«å‚åŠ ',
                gameCode: 'ã‚²ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰',
                enterGameCode: '4æ¡ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›...',
                joinGameButton: 'ã‚²ãƒ¼ãƒ ã«å‚åŠ ',
                waitingForPlayer: '2äººç›®ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å¾…ã£ã¦ã„ã¾ã™...',
                gameCodeLabel: 'ã‚²ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰',
                shareCode: 'ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’2äººç›®ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨å…±æœ‰ã—ã¦ãã ã•ã„',
                backToMenu: 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹',
                gameInProgress: 'ã‚²ãƒ¼ãƒ é€²è¡Œä¸­',
                round: 'ãƒ©ã‚¦ãƒ³ãƒ‰',
                completedRounds: 'å®Œäº†ã—ãŸãƒ©ã‚¦ãƒ³ãƒ‰',
                yourTurnAsk: 'ã‚ãªãŸã®ç•ªã§ã™ - è³ªå•ã—ã¦ãã ã•ã„ï¼',
                questionText: 'è³ªå•å†…å®¹',
                enterQuestion: 'è³ªå•ã‚’å…¥åŠ›...',
                answers: 'ç­”ãˆ',
                answer: 'ç­”ãˆ',
                selectCorrectAnswer: 'æ­£ã—ã„ç­”ãˆã‚’é¸æŠ',
                askQuestion: 'è³ªå•ã™ã‚‹',
                playerAsks: '{name}ãŒè³ªå•ã—ã¦ã„ã¾ã™',
                waiting: 'å¾…æ©Ÿä¸­',
                playerThinking: '{name}ãŒç­”ãˆã‚’è€ƒãˆã¦ã„ã¾ã™',
                playerPreparing: '{name}ãŒè³ªå•ã‚’æº–å‚™ã—ã¦ã„ã¾ã™',
                gameFinished: 'ã‚²ãƒ¼ãƒ çµ‚äº†ï¼',
                winner: 'å‹è€…',
                tie: 'å¼•ãåˆ†ã‘',
                newGame: 'æ–°ã—ã„ã‚²ãƒ¼ãƒ ',
                errorMinAnswers: 'å°‘ãªãã¨ã‚‚2ã¤ã®ç­”ãˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
                errorEmptyName: 'åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
                errorEmptyCode: 'ã‚²ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
                errorEmptyQuestion: 'è³ªå•å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
                errorInvalidCode: 'æœ‰åŠ¹ãª4æ¡ã®ã‚²ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
                errorConnection: 'ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šã‚¨ãƒ©ãƒ¼',
                gameCreated: 'ã‚²ãƒ¼ãƒ ãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼ã‚³ãƒ¼ãƒ‰ï¼š{code}',
                playerJoined: '{name}ãŒã‚²ãƒ¼ãƒ ã«å‚åŠ ã—ã¾ã—ãŸï¼ã‚²ãƒ¼ãƒ é–‹å§‹ï¼',
                answerCorrect: '{name}ãŒæ­£ã—ãç­”ãˆã¦1ãƒã‚¤ãƒ³ãƒˆç²å¾—ï¼',
                answerIncorrect: '{name}ãŒé–“é•ãˆã¾ã—ãŸã€‚æ­£ã—ã„ç­”ãˆã¯ï¼š{correct}',
                gameFinishedWinner: 'ã‚²ãƒ¼ãƒ çµ‚äº†ï¼{name}ãŒ{score}ãƒã‚¤ãƒ³ãƒˆã§å‹åˆ©ï¼',
                tieBreaker: 'å¼•ãåˆ†ã‘ï¼ç¬¬{round}ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¤ãƒ–ãƒ¬ãƒ¼ã‚¯ï¼',
                nextRound: 'ãƒ©ã‚¦ãƒ³ãƒ‰{prev}çµ‚äº†ã€‚ãƒ©ã‚¦ãƒ³ãƒ‰{next}é–‹å§‹ï¼',
                gameFinished3Points: '{name}ãŒ3ãƒã‚¤ãƒ³ãƒˆç²å¾—ã—ã€ã‚²ãƒ¼ãƒ ã«å‹åˆ©ï¼',
                errorJoinRoom: 'æŒ‡å®šã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã®ã‚²ãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€æº€å“¡ã§ã™',
                errorSubmitAnswer: 'ä»Šã¯ç­”ãˆã‚‰ã‚Œã¾ã›ã‚“',
                errorSubmitQuestion: 'ä»Šã¯è³ªå•ã§ãã¾ã›ã‚“',
                reconnectSuccess: 'å†æ¥ç¶šã«æˆåŠŸã—ã¾ã—ãŸï¼',
                playerRejoined: '{name}ãŒã‚²ãƒ¼ãƒ ã«æˆ»ã£ã¦ãã¾ã—ãŸï¼',
                errorReconnect: 'ã‚²ãƒ¼ãƒ ã‚’å¾©å…ƒã§ãã¾ã›ã‚“ã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚',
                questionSubmitted: 'è³ªå•ãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸ',
                answerSubmitted: 'å›ç­”ãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸ'
            },
            pt: {
                subtitle: 'Jogo para dois jogadores',
                createNewGame: 'Criar Novo Jogo',
                yourName: 'Seu Nome',
                enterYourName: 'Digite seu nome...',
                createNewGameButton: 'Criar Novo Jogo',
                or: 'ou',
                joinGame: 'Entrar no Jogo',
                gameCode: 'CÃ³digo do Jogo',
                enterGameCode: 'Digite o cÃ³digo de 4 dÃ­gitos...',
                joinGameButton: 'Entrar no Jogo',
                waitingForPlayer: 'Aguardando segundo jogador...',
                gameCodeLabel: 'CÃ³digo do Jogo',
                shareCode: 'Compartilhe este cÃ³digo com o segundo jogador',
                backToMenu: 'Voltar ao Menu',
                gameInProgress: 'Jogo em Andamento',
                round: 'Rodada',
                completedRounds: 'Rodadas Completadas',
                yourTurnAsk: 'Sua vez - faÃ§a uma pergunta!',
                questionText: 'Texto da Pergunta',
                enterQuestion: 'Digite sua pergunta...',
                answers: 'Respostas',
                answer: 'Resposta',
                selectCorrectAnswer: 'Selecione a resposta correta',
                askQuestion: 'Fazer Pergunta',
                playerAsks: '{name} pergunta',
                waiting: 'Aguardando',
                playerThinking: '{name} estÃ¡ pensando na resposta',
                playerPreparing: '{name} estÃ¡ preparando uma pergunta',
                gameFinished: 'Jogo Terminado!',
                winner: 'Vencedor',
                tie: 'Empate',
                newGame: 'Novo Jogo',
                errorMinAnswers: 'ForneÃ§a pelo menos 2 respostas',
                errorEmptyName: 'Digite seu nome',
                errorEmptyCode: 'Digite o cÃ³digo do jogo',
                errorEmptyQuestion: 'Digite o texto da pergunta',
                errorInvalidCode: 'Digite um cÃ³digo de jogo vÃ¡lido de 4 dÃ­gitos',
                errorConnection: 'Erro de conexÃ£o com o servidor',
                gameCreated: 'Jogo criado! CÃ³digo: {code}',
                playerJoined: '{name} entrou no jogo! Jogo iniciado!',
                answerCorrect: '{name} respondeu corretamente e ganhou 1 ponto!',
                answerIncorrect: '{name} respondeu incorretamente. A resposta correta Ã©: {correct}',
                gameFinishedWinner: 'Jogo terminado! {name} venceu com {score} pontos!',
                tieBreaker: 'Empate! Rodada de desempate {round}!',
                nextRound: 'Fim da rodada {prev}. Iniciando rodada {next}!',
                gameFinished3Points: '{name} alcanÃ§ou 3 pontos e venceu o jogo!',
                errorJoinRoom: 'Jogo nÃ£o encontrado com o cÃ³digo fornecido ou jogo estÃ¡ cheio',
                errorSubmitAnswer: 'VocÃª nÃ£o pode responder agora',
                errorSubmitQuestion: 'VocÃª nÃ£o pode fazer uma pergunta agora',
                reconnectSuccess: 'Reconectado com sucesso!',
                playerRejoined: '{name} voltou ao jogo!',
                errorReconnect: 'NÃ£o foi possÃ­vel restaurar o jogo. Jogador nÃ£o encontrado.',
                questionSubmitted: 'Pergunta enviada',
                answerSubmitted: 'Resposta enviada'
            },
            ga: {
                subtitle: 'Cluiche do dhaoine',
                createNewGame: 'Cruthaigh Cluiche Nua',
                yourName: 'D\'ainm',
                enterYourName: 'Cuir isteach d\'ainm...',
                createNewGameButton: 'Cruthaigh Cluiche Nua',
                or: 'nÃ³',
                joinGame: 'Glac PÃ¡irt sa Chluiche',
                gameCode: 'CÃ³d an Chluiche',
                enterGameCode: 'Cuir isteach cÃ³d 4 dhigit...',
                joinGameButton: 'Glac PÃ¡irt',
                waitingForPlayer: 'Ag fanacht leis an dara himreoir...',
                gameCodeLabel: 'CÃ³d an Chluiche',
                shareCode: 'Roinn an cÃ³d seo leis an dara himreoir',
                backToMenu: 'Ar ais go dtÃ­ an roghchlÃ¡r',
                gameInProgress: 'Cluiche ar siÃºl',
                round: 'Timthriall',
                completedRounds: 'Timthriallta CrÃ­ochnaithe',
                yourTurnAsk: 'Do sheal - cuir ceist!',
                questionText: 'TÃ©acs na Ceiste',
                enterQuestion: 'Cuir isteach do cheist...',
                answers: 'FreagraÃ­',
                answer: 'Freagra',
                selectCorrectAnswer: 'Roghnaigh an freagra ceart',
                askQuestion: 'Cuir Ceist',
                playerAsks: 'cuireann {name} ceist',
                waiting: 'Ag fanacht',
                playerThinking: 'tÃ¡ {name} ag smaoineamh ar an bhfreagra',
                playerPreparing: 'tÃ¡ {name} ag ullmhÃº ceiste',
                gameFinished: 'Cluiche CrÃ­ochnaithe!',
                winner: 'Buaiteoir',
                tie: 'ComhscÃ³r',
                newGame: 'Cluiche Nua',
                errorMinAnswers: 'Cuir ar a laghad 2 fhreagra ar fÃ¡il',
                errorEmptyName: 'Cuir isteach d\'ainm',
                errorEmptyCode: 'Cuir isteach cÃ³d an chluiche',
                errorEmptyQuestion: 'Cuir isteach tÃ©acs na ceiste',
                errorInvalidCode: 'Cuir isteach cÃ³d cluiche bailÃ­ 4 dhigit',
                errorConnection: 'EarrÃ¡id ceangail leis an bhfreastalaÃ­',
                gameCreated: 'Cluiche cruthaithe! CÃ³d: {code}',
                playerJoined: 'thÃ¡inig {name} isteach sa chluiche! TosaÃ­odh an cluiche!',
                answerCorrect: 'd\'fhreagair {name} i gceart agus fuair sÃ© 1 phointe!',
                answerIncorrect: 'd\'fhreagair {name} go mÃ­cheart. Is Ã© an freagra ceart: {correct}',
                gameFinishedWinner: 'Cluiche crÃ­ochnaithe! Bhuaigh {name} le {score} pointe!',
                tieBreaker: 'ComhscÃ³r! Timthriall rÃ©itigh {round}!',
                nextRound: 'CrÃ­och an timthriall {prev}. TosaÃ­onn timthriall {next}!',
                gameFinished3Points: 'shroich {name} 3 phointe agus bhuaigh an cluiche!',
                errorJoinRoom: 'NÃ­or aimsÃ­odh cluiche leis an gcÃ³d seo nÃ³ tÃ¡ an cluiche lÃ¡n',
                errorSubmitAnswer: 'NÃ­ fÃ©idir leat freagra a thabhairt anois',
                errorSubmitQuestion: 'NÃ­ fÃ©idir leat ceist a chur anois',
                reconnectSuccess: 'Athcheangail rathÃºil!',
                playerRejoined: 'thÃ¡inig {name} ar ais sa chluiche!',
                errorReconnect: 'NÃ­ fÃ©idir an cluiche a athbhunÃº. NÃ­or aimsÃ­odh an t-imreoir.',
                questionSubmitted: 'Ceist curtha isteach',
                answerSubmitted: 'Freagra curtha isteach'
            },
            hi: {
                subtitle: 'à¤¦à¥‹ à¤–à¤¿à¤²à¤¾à¤¡à¤¼à¤¿à¤¯à¥‹à¤‚ à¤•à¥‡ à¤²à¤¿à¤ à¤–à¥‡à¤²',
                createNewGame: 'à¤¨à¤¯à¤¾ à¤–à¥‡à¤² à¤¬à¤¨à¤¾à¤à¤‚',
                yourName: 'à¤†à¤ªà¤•à¤¾ à¤¨à¤¾à¤®',
                enterYourName: 'à¤…à¤ªà¤¨à¤¾ à¤¨à¤¾à¤® à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚...',
                createNewGameButton: 'à¤¨à¤¯à¤¾ à¤–à¥‡à¤² à¤¬à¤¨à¤¾à¤à¤‚',
                or: 'à¤¯à¤¾',
                joinGame: 'à¤–à¥‡à¤² à¤®à¥‡à¤‚ à¤¶à¤¾à¤®à¤¿à¤² à¤¹à¥‹à¤‚',
                gameCode: 'à¤–à¥‡à¤² à¤•à¥‹à¤¡',
                enterGameCode: '4 à¤…à¤‚à¤•à¥‹à¤‚ à¤•à¤¾ à¤•à¥‹à¤¡ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚...',
                joinGameButton: 'à¤–à¥‡à¤² à¤®à¥‡à¤‚ à¤¶à¤¾à¤®à¤¿à¤² à¤¹à¥‹à¤‚',
                waitingForPlayer: 'à¤¦à¥‚à¤¸à¤°à¥‡ à¤–à¤¿à¤²à¤¾à¤¡à¤¼à¥€ à¤•à¥€ à¤ªà¥à¤°à¤¤à¥€à¤•à¥à¤·à¤¾ à¤•à¤° à¤°à¤¹à¥‡ à¤¹à¥ˆà¤‚...',
                gameCodeLabel: 'à¤–à¥‡à¤² à¤•à¥‹à¤¡',
                shareCode: 'à¤‡à¤¸ à¤•à¥‹à¤¡ à¤•à¥‹ à¤¦à¥‚à¤¸à¤°à¥‡ à¤–à¤¿à¤²à¤¾à¤¡à¤¼à¥€ à¤•à¥‡ à¤¸à¤¾à¤¥ à¤¸à¤¾à¤à¤¾ à¤•à¤°à¥‡à¤‚',
                backToMenu: 'à¤®à¥‡à¤¨à¥‚ à¤ªà¤° à¤µà¤¾à¤ªà¤¸ à¤œà¤¾à¤à¤‚',
                gameInProgress: 'à¤–à¥‡à¤² à¤šà¤² à¤°à¤¹à¤¾ à¤¹à¥ˆ',
                round: 'à¤°à¤¾à¤‰à¤‚à¤¡',
                completedRounds: 'à¤ªà¥‚à¤°à¥à¤£ à¤°à¤¾à¤‰à¤‚à¤¡',
                yourTurnAsk: 'à¤†à¤ªà¤•à¥€ à¤¬à¤¾à¤°à¥€ - à¤ªà¥à¤°à¤¶à¥à¤¨ à¤ªà¥‚à¤›à¥‡à¤‚!',
                questionText: 'à¤ªà¥à¤°à¤¶à¥à¤¨ à¤•à¤¾ à¤ªà¤¾à¤ ',
                enterQuestion: 'à¤…à¤ªà¤¨à¤¾ à¤ªà¥à¤°à¤¶à¥à¤¨ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚...',
                answers: 'à¤‰à¤¤à¥à¤¤à¤°',
                answer: 'à¤‰à¤¤à¥à¤¤à¤°',
                selectCorrectAnswer: 'à¤¸à¤¹à¥€ à¤‰à¤¤à¥à¤¤à¤° à¤šà¥à¤¨à¥‡à¤‚',
                askQuestion: 'à¤ªà¥à¤°à¤¶à¥à¤¨ à¤ªà¥‚à¤›à¥‡à¤‚',
                playerAsks: '{name} à¤ªà¥à¤°à¤¶à¥à¤¨ à¤ªà¥‚à¤›à¤¤à¤¾ à¤¹à¥ˆ',
                waiting: 'à¤ªà¥à¤°à¤¤à¥€à¤•à¥à¤·à¤¾ à¤•à¤° à¤°à¤¹à¥‡ à¤¹à¥ˆà¤‚',
                playerThinking: '{name} à¤‰à¤¤à¥à¤¤à¤° à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚ à¤¸à¥‹à¤š à¤°à¤¹à¤¾ à¤¹à¥ˆ',
                playerPreparing: '{name} à¤ªà¥à¤°à¤¶à¥à¤¨ à¤¤à¥ˆà¤¯à¤¾à¤° à¤•à¤° à¤°à¤¹à¤¾ à¤¹à¥ˆ',
                gameFinished: 'à¤–à¥‡à¤² à¤¸à¤®à¤¾à¤ªà¥à¤¤!',
                winner: 'à¤µà¤¿à¤œà¥‡à¤¤à¤¾',
                tie: 'à¤¬à¤°à¤¾à¤¬à¤°à¥€',
                newGame: 'à¤¨à¤¯à¤¾ à¤–à¥‡à¤²',
                errorMinAnswers: 'à¤•à¤® à¤¸à¥‡ à¤•à¤® 2 à¤‰à¤¤à¥à¤¤à¤° à¤ªà¥à¤°à¤¦à¤¾à¤¨ à¤•à¤°à¥‡à¤‚',
                errorEmptyName: 'à¤…à¤ªà¤¨à¤¾ à¤¨à¤¾à¤® à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚',
                errorEmptyCode: 'à¤–à¥‡à¤² à¤•à¥‹à¤¡ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚',
                errorEmptyQuestion: 'à¤ªà¥à¤°à¤¶à¥à¤¨ à¤•à¤¾ à¤ªà¤¾à¤  à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚',
                errorInvalidCode: 'à¤®à¤¾à¤¨à¥à¤¯ 4 à¤…à¤‚à¤•à¥‹à¤‚ à¤•à¤¾ à¤–à¥‡à¤² à¤•à¥‹à¤¡ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚',
                errorConnection: 'à¤¸à¤°à¥à¤µà¤° à¤¸à¥‡ à¤•à¤¨à¥‡à¤•à¥à¤¶à¤¨ à¤¤à¥à¤°à¥à¤Ÿà¤¿',
                gameCreated: 'à¤–à¥‡à¤² à¤¬à¤¨à¤¾à¤¯à¤¾ à¤—à¤¯à¤¾! à¤•à¥‹à¤¡: {code}',
                playerJoined: '{name} à¤–à¥‡à¤² à¤®à¥‡à¤‚ à¤¶à¤¾à¤®à¤¿à¤² à¤¹à¥‹ à¤—à¤¯à¤¾! à¤–à¥‡à¤² à¤¶à¥à¤°à¥‚ à¤¹à¥à¤†!',
                answerCorrect: '{name} à¤¨à¥‡ à¤¸à¤¹à¥€ à¤‰à¤¤à¥à¤¤à¤° à¤¦à¤¿à¤¯à¤¾ à¤”à¤° 1 à¤…à¤‚à¤• à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤•à¤¿à¤¯à¤¾!',
                answerIncorrect: '{name} à¤¨à¥‡ à¤—à¤²à¤¤ à¤‰à¤¤à¥à¤¤à¤° à¤¦à¤¿à¤¯à¤¾à¥¤ à¤¸à¤¹à¥€ à¤‰à¤¤à¥à¤¤à¤° à¤¹à¥ˆ: {correct}',
                gameFinishedWinner: 'à¤–à¥‡à¤² à¤¸à¤®à¤¾à¤ªà¥à¤¤! {name} à¤¨à¥‡ {score} à¤…à¤‚à¤•à¥‹à¤‚ à¤¸à¥‡ à¤œà¥€à¤¤ à¤¹à¤¾à¤¸à¤¿à¤² à¤•à¥€!',
                tieBreaker: 'à¤¬à¤°à¤¾à¤¬à¤°à¥€! à¤Ÿà¤¾à¤ˆà¤¬à¥à¤°à¥‡à¤•à¤° à¤°à¤¾à¤‰à¤‚à¤¡ {round}!',
                nextRound: 'à¤°à¤¾à¤‰à¤‚à¤¡ {prev} à¤¸à¤®à¤¾à¤ªà¥à¤¤à¥¤ à¤°à¤¾à¤‰à¤‚à¤¡ {next} à¤¶à¥à¤°à¥‚ à¤¹à¥‹ à¤°à¤¹à¤¾ à¤¹à¥ˆ!',
                gameFinished3Points: '{name} à¤¨à¥‡ 3 à¤…à¤‚à¤• à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤•à¤¿à¤ à¤”à¤° à¤–à¥‡à¤² à¤œà¥€à¤¤à¤¾!',
                errorJoinRoom: 'à¤¦à¤¿à¤ à¤—à¤ à¤•à¥‹à¤¡ à¤•à¤¾ à¤–à¥‡à¤² à¤¨à¤¹à¥€à¤‚ à¤®à¤¿à¤²à¤¾ à¤¯à¤¾ à¤–à¥‡à¤² à¤ªà¥‚à¤°à¥à¤£ à¤¹à¥ˆ',
                errorSubmitAnswer: 'à¤†à¤ª à¤…à¤­à¥€ à¤‰à¤¤à¥à¤¤à¤° à¤¨à¤¹à¥€à¤‚ à¤¦à¥‡ à¤¸à¤•à¤¤à¥‡',
                errorSubmitQuestion: 'à¤†à¤ª à¤…à¤­à¥€ à¤ªà¥à¤°à¤¶à¥à¤¨ à¤¨à¤¹à¥€à¤‚ à¤ªà¥‚à¤› à¤¸à¤•à¤¤à¥‡',
                reconnectSuccess: 'à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤ªà¥à¤¨à¤ƒ à¤•à¤¨à¥‡à¤•à¥à¤Ÿ à¤¹à¥à¤†!',
                playerRejoined: '{name} à¤µà¤¾à¤ªà¤¸ à¤–à¥‡à¤² à¤®à¥‡à¤‚ à¤† à¤—à¤¯à¤¾!',
                errorReconnect: 'à¤–à¥‡à¤² à¤•à¥‹ à¤ªà¥à¤¨à¤°à¥à¤¸à¥à¤¥à¤¾à¤ªà¤¿à¤¤ à¤¨à¤¹à¥€à¤‚ à¤•à¤¿à¤¯à¤¾ à¤œà¤¾ à¤¸à¤•à¤¤à¤¾à¥¤ à¤–à¤¿à¤²à¤¾à¤¡à¤¼à¥€ à¤¨à¤¹à¥€à¤‚ à¤®à¤¿à¤²à¤¾à¥¤',
                questionSubmitted: 'à¤ªà¥à¤°à¤¶à¥à¤¨ à¤¸à¤¬à¤®à¤¿à¤Ÿ à¤•à¤¿à¤¯à¤¾ à¤—à¤¯à¤¾',
                answerSubmitted: 'à¤‰à¤¤à¥à¤¤à¤° à¤¸à¤¬à¤®à¤¿à¤Ÿ à¤•à¤¿à¤¯à¤¾ à¤—à¤¯à¤¾'
            }
        };

        // Tworzenie instancji i18n
        const i18n = createI18n({
            locale: getBrowserLanguage(),
            fallbackLocale: 'en',
            messages
        });

        const app = createApp({
            setup() {
                const gameState = ref('menu');
                const playerNameCreate = ref('');
                const playerNameJoin = ref('');
                const currentPlayerName = ref('');
                const gameCode = ref('');
                const room = ref(null);
                const currentPlayer = ref(null);
                const socket = ref(null);
                const message = ref('');
                const error = ref('');
                const connectionState = ref('disconnected');

                // ObsÅ‚uga jÄ™zyka
                const currentLocale = ref(getBrowserLanguage());

                const changeLanguage = (locale) => {
                    i18n.global.locale = locale;
                    currentLocale.value = locale;
                    document.documentElement.lang = locale;
                    localStorage.setItem('preferredLanguage', locale);
                };

                // Inicjalizacja - ustaw jÄ™zyk na podstawie getBrowserLanguage
                const initialLocale = getBrowserLanguage();
                changeLanguage(initialLocale);

                const questionForm = ref({
                    text: '',
                    answers: ['', '', '', '', ''],
                    correctAnswer: 0
                });

                const selectedAnswer = ref(-1);

                const isMyTurn = computed(() => {
                    return room.value && currentPlayer.value &&
                        room.value.currentPlayerTurn === currentPlayer.value.id;
                });

                const otherPlayer = computed(() => {
                    if (!room.value || !currentPlayer.value) return null;
                    return room.value.players.find(p => p.id !== currentPlayer.value.id);
                });

                const isConnected = computed(() => {
                    return connectionState.value === 'connected';
                });

                const isReconnecting = computed(() => {
                    return connectionState.value === 'reconnecting';
                });

                const canAskQuestion = computed(() => {
                    return isMyTurn.value && !room.value?.currentQuestion;
                });

                const canAnswerQuestion = computed(() => {
                    return !isMyTurn.value && room.value?.currentQuestion;
                });

                // Game state persistence
                function saveGameState() {
                    if (room.value && currentPlayer.value) {
                        const state = {
                            room: room.value,
                            currentPlayer: currentPlayer.value,
                            currentPlayerName: currentPlayerName.value,
                            timestamp: Date.now()
                        };
                        localStorage.setItem('quizGameState', JSON.stringify(state));
                    }
                }

                function clearGameState() {
                    localStorage.removeItem('quizGameState');
                }

                function loadGameState() {
                    const saved = localStorage.getItem('quizGameState');
                    if (saved) {
                        try {
                            const state = JSON.parse(saved);
                            // Check if state is not too old (24 hours)
                            if (Date.now() - state.timestamp < 24 * 60 * 60 * 1000) {
                                return state;
                            } else {
                                clearGameState();
                            }
                        } catch (e) {
                            console.error('Failed to parse saved game state:', e);
                            clearGameState();
                        }
                    }
                    return null;
                }

                function connectWebSocket() {
                    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                    const wsUrl = `${protocol}//${window.location.host}`;

                    socket.value = new WebSocket(wsUrl);

                    socket.value.onopen = () => {
                        console.log('Connected to server');
                        connectionState.value = 'connected';
                        error.value = '';

                        // Check if we need to rejoin a game
                        const savedState = loadGameState();
                        if (savedState && savedState.room && savedState.currentPlayer) {
                            console.log('Attempting to rejoin game:', savedState.room.code, 'with ID:', savedState.room.id);
                            socket.value.send(JSON.stringify({
                                type: 'rejoin',
                                data: {
                                    roomId: savedState.room.id,  // Use actual room ID, not code
                                    playerId: savedState.currentPlayer.id,
                                    playerName: savedState.currentPlayer.name
                                }
                            }));
                        }
                    };

                    socket.value.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        handleServerMessage(data);
                    };

                    socket.value.onclose = () => {
                        console.log('Disconnected from server');
                        // Only show disconnection error if we're not intentionally resetting
                        if (gameState.value !== 'menu') {
                            connectionState.value = 'disconnected';
                            error.value = 'Connection to server was interrupted';
                        }
                    };

                    socket.value.onerror = (err) => {
                        console.error('WebSocket error:', err);
                        // Only show connection error if we're not intentionally resetting
                        if (gameState.value !== 'menu') {
                            connectionState.value = 'disconnected';
                            error.value = 'Connection error with server';
                        }
                    };
                }

                function handleServerMessage(data) {
                    console.log('Received message:', data.type, data);

                    // Save game state on any game update
                    if (data.type === 'gameUpdate' || data.type === 'playerDisconnected' || data.type === 'rejoinSuccess') {
                        saveGameState();
                    }

                    switch (data.type) {
                        case 'gameUpdate':
                            console.log('Game update received:', data.data);
                            room.value = data.data.room;
                            if (data.data.code) {
                                message.value = i18n.global.t(data.data.code, data.data.params || {});
                            } else {
                                message.value = data.data.message || '';
                            }

                            if (room.value && currentPlayerName.value) {
                                currentPlayer.value = room.value.players.find(p => p.name === currentPlayerName.value);
                                console.log('Current player identified:', currentPlayer.value);
                                console.log('Room current turn:', room.value.currentPlayerTurn);
                                console.log('Current question:', room.value.currentQuestion);
                                console.log('isMyTurn:', isMyTurn.value);
                                console.log('canAskQuestion:', canAskQuestion.value);
                                console.log('canAnswerQuestion:', canAnswerQuestion.value);
                            }

                            if (room.value) {
                                if (room.value.gameState === 'waiting') {
                                    gameState.value = 'waiting';
                                } else if (room.value.gameState === 'playing') {
                                    gameState.value = 'playing';
                                } else if (room.value.gameState === 'finished') {
                                    gameState.value = 'finished';
                                    // Clear saved state when game finishes
                                    clearGameState();
                                    // Let players restart on demand using the button
                                }
                            }
                            break;

                        case 'rejoinSuccess':
                            console.log('Rejoin successful:', data.data);
                            room.value = data.data.room;
                            currentPlayer.value = data.data.player;
                            if (data.data.code) {
                                message.value = i18n.global.t(data.data.code, data.data.params || {});
                            } else {
                                message.value = data.data.message || 'Successfully restored connection!';
                            }

                            if (room.value) {
                                if (room.value.gameState === 'waiting') {
                                    gameState.value = 'waiting';
                                } else if (room.value.gameState === 'playing') {
                                    gameState.value = 'playing';
                                } else if (room.value.gameState === 'finished') {
                                    gameState.value = 'finished';
                                }
                            }
                            break;

                        case 'rejoinFailed':
                            console.log('Rejoin failed:', data.data);
                            if (data.data.code) {
                                error.value = i18n.global.t(data.data.code, data.data.params || {});
                            } else {
                                error.value = data.data.message;
                            }
                            clearGameState(); // Clear invalid state
                            gameState.value = 'menu';
                            break;

                        case 'error':
                            console.error('Server error:', data.data);
                            if (data.data.code) {
                                error.value = i18n.global.t(data.data.code, data.data.params || {});
                            } else {
                                error.value = data.data.message;
                            }
                            break;

                        case 'playerDisconnected':
                            room.value = data.data.room;
                            message.value = data.data.message;
                            break;
                    }
                }

                function createGame() {
                    if (!playerNameCreate.value.trim()) {
                        error.value = i18n.global.t('errorEmptyName');
                        return;
                    }

                    currentPlayerName.value = playerNameCreate.value.trim();
                    error.value = '';
                    connectWebSocket();

                    socket.value.onopen = () => {
                        socket.value.send(JSON.stringify({
                            type: 'create',
                            data: { playerName: currentPlayerName.value }
                        }));
                    };
                }

                function joinGame() {
                    if (!playerNameJoin.value.trim()) {
                        error.value = i18n.global.t('errorEmptyName');
                        return;
                    }

                    if (gameCode.value < 1111 || gameCode.value > 9999) {
                        error.value = i18n.global.t('errorInvalidCode');
                        return;
                    }

                    currentPlayerName.value = playerNameJoin.value.trim();
                    error.value = '';
                    connectWebSocket();

                    socket.value.onopen = () => {
                        socket.value.send(JSON.stringify({
                            type: 'join',
                            data: {
                                playerName: currentPlayerName.value,
                                gameCode: String(gameCode.value)
                            }
                        }));
                    };
                }

                function submitQuestion() {
                    console.log('Submitting question...');
                    console.log('Current player:', currentPlayer.value);
                    console.log('Room current turn:', room.value?.currentPlayerTurn);
                    console.log('isMyTurn:', isMyTurn.value);

                    if (!questionForm.value.text.trim()) {
                        error.value = i18n.global.t('errorEmptyQuestion');
                        return;
                    }

                    const filledAnswers = questionForm.value.answers.filter(a => a.trim());
                    if (filledAnswers.length < 2) {
                        error.value = i18n.global.t('errorMinAnswers');
                        return;
                    }

                    error.value = '';

                    socket.value.send(JSON.stringify({
                        type: 'submitQuestion',
                        data: {
                            text: questionForm.value.text.trim(),
                            answers: questionForm.value.answers.map(a => a.trim()).filter(a => a),
                            correctAnswer: questionForm.value.correctAnswer
                        }
                    }));

                    questionForm.value = {
                        text: '',
                        answers: ['', '', '', '', ''],
                        correctAnswer: 0
                    };
                }

                function submitAnswer() {
                    if (selectedAnswer.value === -1) {
                        error.value = 'Select an answer';
                        return;
                    }

                    error.value = '';

                    socket.value.send(JSON.stringify({
                        type: 'submitAnswer',
                        data: {
                            questionId: room.value.currentQuestion.id,
                            selectedAnswer: selectedAnswer.value
                        }
                    }));

                    selectedAnswer.value = -1;
                }

                function resetGame() {
                    gameState.value = 'menu';
                    playerNameCreate.value = '';
                    playerNameJoin.value = '';
                    currentPlayerName.value = '';
                    gameCode.value = '';
                    room.value = null;
                    currentPlayer.value = null;
                    message.value = '';
                    error.value = '';
                    selectedAnswer.value = -1;

                    // Clear saved game state
                    clearGameState();

                    // Don't close WebSocket connection - keep it open for new games
                    // The connection should remain active for the same session
                }

                function resetGameAfterFinish() {
                    // Special reset for game end - keep connection open
                    gameState.value = 'menu';
                    playerNameCreate.value = '';
                    playerNameJoin.value = '';
                    gameCode.value = '';
                    room.value = null;
                    currentPlayer.value = null;
                    message.value = '';
                    error.value = '';
                    selectedAnswer.value = -1;

                    // Clear saved game state but keep connection
                    clearGameState();

                    // Reset connection state to avoid disconnection alerts
                    connectionState.value = 'connected';
                }

                onMounted(() => {
                    console.log('Component mounted, checking for saved game state...');

                    // Check URL query parameter 'q' for game code
                    const urlParams = new URLSearchParams(window.location.search);
                    const queryGameCode = urlParams.get('q');
                    if (queryGameCode && queryGameCode.match(/^\d{4}$/)) {
                        console.log('Game code found in URL query parameter q:', queryGameCode);
                        gameCode.value = queryGameCode;
                        // Focus on the name input field for joining
                        setTimeout(() => {
                            const nameInput = document.querySelector('.oponent-name');
                            if (nameInput) nameInput.focus();
                        }, 100);
                    }

                    // Auto-connect on page load if we have saved game state
                    const savedGameState = localStorage.getItem('quizGameState');
                    console.log('Saved game state found:', !!savedGameState);

                    if (savedGameState) {
                        try {
                            const state = JSON.parse(savedGameState);

                            if (state.room && state.currentPlayer) {
                                room.value = state.room;
                                currentPlayer.value = state.currentPlayer;
                                currentPlayerName.value = state.currentPlayerName;
                                gameState.value = 'reconnecting';
                                connectionState.value = 'connecting';
                                error.value = 'Restoring connection...';

                                // Attempt to reconnect
                                setTimeout(() => {
                                    console.log('Connecting WebSocket...');
                                    connectWebSocket();
                                }, 100);
                            }
                        } catch (e) {
                            console.error('Failed to parse saved game state:', e);
                            clearGameState();
                        }
                    }

                    // Handle page visibility changes for mobile
                    function handleVisibilityChange() {
                        if (document.hidden) {
                            console.log('Page hidden - maintaining connection');
                        } else {
                            console.log('Page visible - checking connection');
                            if (socket.value && socket.value.readyState !== WebSocket.OPEN && room.value) {
                                connectWebSocket();
                            }
                        }
                    }

                    function handleOnline() {
                        console.log('Network online');
                        if (room.value && connectionState.value !== 'connected') {
                            connectWebSocket();
                        }
                    }

                    function handleOffline() {
                        console.log('Network offline');
                        error.value = 'No internet connection';
                        connectionState.value = 'disconnected';
                    }

                    document.addEventListener('visibilitychange', handleVisibilityChange);
                    window.addEventListener('online', handleOnline);
                    window.addEventListener('offline', handleOffline);

                    // Store references for cleanup
                    window.__quizGameHandlers = {
                        visibility: handleVisibilityChange,
                        online: handleOnline,
                        offline: handleOffline
                    };
                });

                onUnmounted(() => {
                    // Clean up event listeners using stored references
                    if (window.__quizGameHandlers) {
                        document.removeEventListener('visibilitychange', window.__quizGameHandlers.visibility);
                        window.removeEventListener('online', window.__quizGameHandlers.online);
                        window.removeEventListener('offline', window.__quizGameHandlers.offline);
                        delete window.__quizGameHandlers;
                    }

                    // Clean up connection
                    if (socket.value) {
                        socket.value.close();
                        socket.value = null;
                    }
                });

                return {
                    gameState,
                    playerNameCreate,
                    playerNameJoin,
                    currentPlayerName,
                    gameCode,
                    room,
                    currentPlayer,
                    message,
                    error,
                    questionForm,
                    selectedAnswer,
                    isMyTurn,
                    otherPlayer,
                    canAskQuestion,
                    canAnswerQuestion,
                    isConnected,
                    isReconnecting,
                    currentLocale,
                    changeLanguage,
                    createGame,
                    joinGame,
                    submitQuestion,
                    submitAnswer,
                    resetGame
                };
            }
        });

        // UÅ¼ywanie i18n plugin
        app.use(i18n);
        app.mount('#app');
    </script>
</body>

</html>